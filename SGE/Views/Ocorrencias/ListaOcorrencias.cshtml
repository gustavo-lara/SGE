@model IEnumerable<SGE.Models.Ocorrencia>

@{
	ViewData["Title"] = "ListaOcorrencias";
	List<Aluno> listaAlunos = (List<Aluno>)ViewData["listaAlunos"];

	if (listaAlunos.Count() == 0)
	{
		ViewData["Erro"] = "Não foram encontrados registros para a busca realizada.";
	}
	if (Model.Count() > 0)
	{
		Model.OrderBy(d => d.DataOcorrencia);
	}

}

<div>
    <div class="d-flex row justify-content-between my-5">
        <div style="width: 15%;">
            <img src="/img/imgIndexOcorrencias.png" style="max-width:200px;" />
        </div>
        <div style="width: 85%;" class="ps-5">
            <div class="d-flex row align-items-center justify-content-between">
                <h1 style="width:35%; font-size:3.2rem; color:#F6D524;">Ocorrências</h1>
                <div style="height:5px; width:65%; background:#F6D524;" />
            </div>
            <p style="font-size:1.5rem; color:#fff;">Controle as ocorrências dos alunos.</p>
        </div>
    </div>

	<div>
	</div>
</div>

<div style="display:flex">
	<h3 style="color:white; padding-right: 2em; ">Tipos de Ocorrência</h3>
	<a asp-controller="TiposOcorrencia" asp-action="Create">
		<svg width="35" height="35" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
			<g clip-path="url(#clip0_166_1154)">
				<path d="M39.375 2.8125C40.1209 2.8125 40.8363 3.10882 41.3637 3.63626C41.8912 4.16371 42.1875 4.87908 42.1875 5.625V39.375C42.1875 40.1209 41.8912 40.8363 41.3637 41.3637C40.8363 41.8912 40.1209 42.1875 39.375 42.1875H5.625C4.87908 42.1875 4.16371 41.8912 3.63626 41.3637C3.10882 40.8363 2.8125 40.1209 2.8125 39.375V5.625C2.8125 4.87908 3.10882 4.16371 3.63626 3.63626C4.16371 3.10882 4.87908 2.8125 5.625 2.8125H39.375ZM5.625 0C4.13316 0 2.70242 0.592632 1.64752 1.64752C0.592632 2.70242 0 4.13316 0 5.625L0 39.375C0 40.8668 0.592632 42.2976 1.64752 43.3525C2.70242 44.4074 4.13316 45 5.625 45H39.375C40.8668 45 42.2976 44.4074 43.3525 43.3525C44.4074 42.2976 45 40.8668 45 39.375V5.625C45 4.13316 44.4074 2.70242 43.3525 1.64752C42.2976 0.592632 40.8668 0 39.375 0L5.625 0Z" fill="white" />
				<path d="M22.5 11.25C22.873 11.25 23.2306 11.3982 23.4944 11.6619C23.7581 11.9256 23.9062 12.2833 23.9062 12.6562V21.0938H32.3438C32.7167 21.0938 33.0744 21.2419 33.3381 21.5056C33.6018 21.7694 33.75 22.127 33.75 22.5C33.75 22.873 33.6018 23.2306 33.3381 23.4944C33.0744 23.7581 32.7167 23.9062 32.3438 23.9062H23.9062V32.3438C23.9062 32.7167 23.7581 33.0744 23.4944 33.3381C23.2306 33.6018 22.873 33.75 22.5 33.75C22.127 33.75 21.7694 33.6018 21.5056 33.3381C21.2419 33.0744 21.0938 32.7167 21.0938 32.3438V23.9062H12.6562C12.2833 23.9062 11.9256 23.7581 11.6619 23.4944C11.3982 23.2306 11.25 22.873 11.25 22.5C11.25 22.127 11.3982 21.7694 11.6619 21.5056C11.9256 21.2419 12.2833 21.0938 12.6562 21.0938H21.0938V12.6562C21.0938 12.2833 21.2419 11.9256 21.5056 11.6619C21.7694 11.3982 22.127 11.25 22.5 11.25Z" fill="white" />
			</g>
			<defs>
				<clipPath id="clip0_166_1154">
					<rect width="45" height="45" fill="white" />
				</clipPath>
			</defs>
		</svg>
	</a>
</div>

<table class="table-borderless tabela1">
	<thead>
		<tr style="padding: 0.3em">
			<th style="padding: 0.3em">
				@Html.DisplayNameFor(model => model.TipoOcorrencia.TipoOcorrenciaNome)
			</th>
			<th style="padding: 0.3em">
				@Html.DisplayNameFor(model => model.TipoOcorrencia.CadAtivo)
			</th>
			<th style="padding: 0.3em">
				@Html.DisplayNameFor(model => model.TipoOcorrencia.CadInativo)
			</th>
			<th></th>
		</tr>
	</thead>
	<tbody class="table-bordered">
		@foreach (var item in Model)
		{
			<tr style="padding: 0.3em">
				<td style="padding: 0.3em">
					@Html.DisplayFor(modelItem => item.TipoOcorrencia.TipoOcorrenciaNome)
				</td>
				<td style="padding: 0.3em">
					@Html.DisplayFor(modelItem => item.TipoOcorrencia.CadAtivo)
				</td>
				<td style="padding: 0.3em">
					@Html.DisplayFor(modelItem => item.TipoOcorrencia.CadInativo)
				</td>
				<td style="padding: 0.3em">
					<a class="text-dark" asp-controller="TiposOcorrencia" asp-action="Edit" asp-route-id="@item.TipoOcorrenciaId"><svg bootstrap-icon="PencilSquare" width="19" height="19" aria-label=""></svg></a>
					<a class="text-dark" asp-controller="TiposOcorrencia" asp-action="Details" asp-route-id="@item.TipoOcorrenciaId"><svg bootstrap-icon="Info" width="19" height="19" aria-label=""></svg></a>
					<a class="text-dark" asp-controller="TiposOcorrencia" asp-action="Delete" asp-route-id="@item.TipoOcorrenciaId"><svg bootstrap-icon="Trash" width="19" height="19" aria-label=""></svg></a>
				</td>
			</tr>
		}
	</tbody>
</table>

<div style="display:flex">
	<h3 style="color:white; padding-right: 2em; margin-top:2em">Ocorrências</h3>
</div>


<div class="container">
	@if (ViewData["Erro"] != null)
	{
		<div class="row mt-3">
			<div class="col-md-12 text-center">
				<div class="alert alert-danger">
					<strong> @ViewData["Erro"] </strong>

				</div>
			</div>
		</div>
	}
	<form method="post" asp-action="BuscarAluno">
		<div class="row mt-3">
			<div class="col-md-4">
				<label for="tipoBusca" class="form-label">Buscar por:</label>
				<div class="input-group">
					<select style="background: rgba(255, 255, 255, 0.3);  border: 2px solid white" class="form-select" name="tipoBusca" id="tipoBusca">
						<option selected value="0">Nome</option>
						<option value="1">E-mail</option>
						<option value="2">Matrícula</option>
						<option value="3">Celular</option>
					</select>
				</div>
			</div>
			<div class="col-md-8 text-end">
				<label for="filtro" class="form-label text-start w-100">Digite o valor da busca</label>
				<div class="input-group">
					<input style="background: rgba(255, 255, 255, 0.3);  border: 2px solid white" type="text" class="form-control" name="filtro" id="filtro" placeholder="Buscar por....">
					<button class="btn btn-light" type="submit" id="btnBuscaAluno" asp-action="BuscarAluno">
						<svg bootstrap-icon="Search" width="16" height="16" aria-label="Pesquisar"></svg>
					</button>
				</div>
			</div>
		</div>
	</form>
	@if (ViewData["listaAlunos"] != null)
	{
		<div class="row mt-3">
			<div class="col-12 h-25 overflow-auto">
				<table class="table-borderless tabela1">
					<thead>
						<tr style="padding: 0.3em">
							<th style="padding: 0.3em">
								Nome
							</th>
							<th style="padding: 0.3em">
								E-mail
							</th>
							<th style="padding: 0.3em">
								Matrícula
							</th>
							<th style="padding: 0.3em">
								Celular
							</th>
							<th style="padding: 0.3em">
								Ocorrências
							</th>
						</tr>
					</thead>
					<tbody class="table-bordered">
						@foreach (var item in listaAlunos)
						{
							<tr style="padding: 0.3em">
								<td style="padding: 0.3em">
									@item.AlunoNome
								</td>
								<td style="padding: 0.3em">
									@item.Email
								</td>
								<td style="padding: 0.3em">
									@item.Matricula
								</td>
								<td style="padding: 0.3em">
									@item.Celular
								</td>
								<td style="padding: 0.3em">
									<a asp-action="OcorrenciasAluno" asp-route-id="@item.AlunoId" style="font-weight:700; border: 2.2px solid white" class="btn btn-outline-light">Selecionar</a>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	}

	@if (ViewData["idAluno"] != null)
	{
		<div class="row mt-3">
			<div class="col-8 text-center" style="margin-top:2em;">
				<h3 style="color: white">
					Ocorrências do Aluno <span>@ViewData["nomeAluno"]</span>
				</h3>
			</div>
			<div class="col-4 text-center" style="margin-top:2em;">
				<a asp-action="AdicionarOcorrencia" asp-route-id="@ViewData["idAluno"]" style="font-weight:700; border: 1.8px solid white" class="btn btn-outline-light py-3">Nova Ocorrencia</a>
			</div>
		</div>
		<div class="row mt-3">
			<div class="col-12 h-50 overflow-auto">
				<table class="table-borderless tabela1">
					<thead>
						<tr style="padding: 0.35em">
							<th style="padding: 0.35em">
								Data
							</th>
							<th style="padding: 0.35em">
								Ocorrência
							</th>
							<th style="padding: 0.35em">
								Registrado por
							</th>
							<th style="padding: 0.35em">
								Finalizado
							</th>
							<th style="padding: 0.35em">
								Ações
							</th>
						</tr>
					</thead>
					<tbody class="table-bordered">
						@foreach (var item in Model)
						{
							<tr style="padding: 0.35em">
								<td style="padding: 0.35em">
									@item.DataOcorrencia
								</td>
								<td style="padding: 0.35em">
									@item.Descricao
								</td>
								<td style="padding: 0.35em">
									@item.Usuario.UsuarioNome
								</td>
								<td style="padding: 0.35em">
									@if (item.Finalizado == false)
									{
										if (item.CadAtivo == false)
										{
											<span>
												<svg bootstrap-icon="ExclamationCircle" width="20" height="20" aria-label="Pendente" class="text-info"></svg>
												Pendente
											</span>
										}
										else
										{
											<span>
												<svg bootstrap-icon="Trash3Fill" width="20" height="20" aria-label="Cancelado" class="text-danger"></svg>
												Cancelado
											</span>
										}

									}
									else
									{
										<span>
											<svg bootstrap-icon="CheckCircle" width="20" height="20" aria-label="Finalizado" class="text-success"></svg>
											Finalizado
										</span>
									}
								<td class="d-flex" style="gap:1em">
									<div>
										<a class="text-dark" asp-action="Edit" asp-route-id="@item.OcorrenciaId"><svg bootstrap-icon="PencilSquare" width="19" height="19" aria-label=""></svg></a>

									</div>

									<div>
										<a class="text-dark" asp-action="Delete" asp-route-id="@item.OcorrenciaId"><svg bootstrap-icon="Trash" width="19" height="19" aria-label=""></svg></a>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	}

</div>
